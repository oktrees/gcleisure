const ckeditor={constructor:function(t){return this.config=this._constructorEditorSet(t),new Promise((t,e)=>{console.log(this.config);var i=this._createClick();this._clickTestBtn(),this._constructorPromiseAll([i]).then(i=>{!0===i?t(!0):e(!1)})})},_jqueryAjax:(t,e=null,i=null)=>$.ajax({url:t,type:"POST",data:e,dataType:"json",cache:!1,processData:null==i,contentType:null==i&&"application/x-www-form-urlencoded; charset=UTF-8"}),_getImgList(){var t=$("<div></div>");$(t).append(this.getData());var e=[];return $(t).find("img").filter((t,i)=>{-1!==$(i).prop("src").indexOf(this.config.imgUrl+this.config.tmpFolderName)&&e.push($(i).prop("src").split(this.config.tmpFolderName+"/")[1])}),e},_changeImgTmpName(){var t=$("<div></div>");$(t).append(this.getData()),$(t).find("img").filter((e,i)=>{if(-1!==$(i).prop("src").indexOf(this.config.imgUrl+this.config.tmpFolderName)){var s=this.config.imgUrl+this.config.tmpFolderName,r=this.config.imgUrl+this.config.folderName,o=$(i).prop("src").replace(s,r);$(t).find("img").eq(e).prop("src",o)}}),this.setDataRemove(),this.setData($(t).html())},_setEvtBtn(){this._clickCreateSubmitBtn(),this._clickReadBtnClass(),this._clickUpdateBtn(),this._clickUpdateSubmitBtn(),this._clickDeleteBtn()},_clickCreateSubmitBtn(){$(this.config.createSubmitBtnClass).off("click").on("click",t=>{$(this.config.createSubmitBtnClass).off("click");var e=this.config.crudUrl+"/createConfirm",i=this._getImgList();if(0!==i.length){var s={imgTmpList:i,folderName:this.config.folderName};this._jqueryAjax(e,s).then(()=>{this._changeImgTmpName(),this._clickCreateSubmitBtn()})}else this._clickCreateSubmitBtn()})},_clickReadBtnClass(){$(this.config.readBtnClass).off("click").on("click",t=>{$(this.config.readBtnClass).off("click");var e=this.config.crudUrl+"/read";this._jqueryAjax(e).then(()=>{this._clickReadBtnClass()})})},_clickUpdateBtn(){$(this.config.updateBtnClass).off("click").on("click",t=>{$(this.config.updateBtnClass).off("click");var e=this.config.crudUrl+"/update";this._jqueryAjax(e).then(()=>{this._clickUpdateBtn()})})},_clickUpdateSubmitBtn(){$(this.config.updateSubmitBtnClass).off("click").on("click",t=>{$(this.config.updateSubmitBtnClass).off("click");var e=this.config.crudUrl+"/updateConfirm";this._jqueryAjax(e).then(()=>{this._clickUpdateSubmitBtn()})})},_clickDeleteBtn(){$(this.config.deleteBtnClass).off("click").on("click",t=>{$(this.config.deleteBtnClass).off("click");var e=this.config.crudUrl+"/delete";this._jqueryAjax(e).then(()=>{this._clickDeleteBtn()})})},_constructorEditorSet(t){var e=["rootId","originUrl","crudUrl","uploadUrl","imgUrl","folderName","tmpFolderName","createSubmitBtnClass","readBtnClass","updateBtnClass","updateSubmitBtnClass","deleteBtnClass"];for(var i of e)if(!t.hasOwnProperty(i))return{isRequire:!1,message:"editor set "+i+" isRequire error"};for(var[s,r]of Object.entries(t))if(-1!==e.indexOf(s)&&void 0===r)return!1;return{isRequire:!0,rootId:this._constructorEditorSetIs(t.rootId),originUrl:this._constructorEditorSetIs(t.originUrl),crudUrl:this._constructorEditorSetIs(t.crudUrl),uploadUrl:this._constructorEditorSetIs(t.uploadUrl),imgUrl:this._constructorEditorSetIs(t.imgUrl),folderName:this._constructorEditorSetIs(t.folderName),tmpFolderName:this._constructorEditorSetIs(t.tmpFolderName),createBtnClass:this._constructorEditorSetIs(t.createBtnClass),createSubmitBtnClass:this._constructorEditorSetIs(t.createSubmitBtnClass),readBtnClass:this._constructorEditorSetIs(t.readBtnClass),updateBtnClass:this._constructorEditorSetIs(t.updateBtnClass),updateSubmitBtnClass:this._constructorEditorSetIs(t.updateSubmitBtnClass),deleteBtnClass:this._constructorEditorSetIs(t.deleteBtnClass),isReadOnly:this._constructorEditorSetIs(t.isReadOnly)}},_constructorEditorSetIs:t=>void 0!==t?t:null,_constructorPromiseAll:t=>new Promise((e,i)=>{Promise.all(t).then(t=>{t.map((t,i)=>{!0!==t&&e(!1)}),e(!0)})}),_createClick(){return new Promise((t,e)=>{if(null===this.config.createBtnClass)this._ckeditor($(this.rootId)[0]).then(e=>{t(e)});else $(this.config.createBtnClass).on("click",e=>{this._ckeditor($(rootId)[0]).then(e=>{t(e)})})})},_clickTestBtn(t){$("#test_btn").on("click",t=>{this.toggleReadOnly(),console.log(this.getData())})},_ckeditor:function(t){return new Promise((e,i)=>{if(this.selectDom=t,void 0!==t){var s={extraPlugins:[this.MyCustomUploadAdapterPlugin],toolbar:[]};this.config.isReadOnly&&(s.toolbar=[]),ClassicEditor.create(t,s).then(t=>{t.isReadOnly=!0,this.getData=function(){return t.getData()},this.setData=function(e){let i=t.getData();i+=e,t.setData(i,"text/html")},this.setDataRemove=function(){t.setData("","text/html")},this.destroyEditor=function(){t.destroy()},this.toggleReadOnly=function(){this.config.isReadOnly?(this.config.isReadOnly=!1,t.isReadOnly=!1,$(this.config.rootId).siblings(".ck-editor").find(".ck-toolbar__items").css("display","flex")):(this.config.isReadOnly=!0,t.isReadOnly=!0,$(this.config.rootId).siblings(".ck-editor").find(".ck-toolbar__items").css("display","none"))},this.keyDownPrevent=function(){t.editing.view.document.on("keydown",(t,e)=>{t.stop(),e.preventDefault(),e.stopPropagation()},{priority:"highest"})},this.test=function(){console.log(t.model.clone())},e(!0)})}})},MyCustomUploadAdapterPlugin:function(t){t.plugins.get("FileRepository").createUploadAdapter=(t=>new UploadAdapter(t,Ckeditor.config.uploadUrl,Ckeditor.config.folderName,Ckeditor.config.tmpFolderName))}};function Editor(t,e=0,i=!1,s=null){function r(t){t.plugins.get("FileRepository").createUploadAdapter=(t=>new UploadAdapter(t))}if(this.selectDom=t,console.log(this.MyCustomUploadAdapterPlugin),void 0!==t){if(0==e)var o={extraPlugins:[r]};else if(1==e)o={toolbar:[],extraPlugins:[r]};else if(2==e)o={};ClassicEditor.create(t,o).then(t=>{1==e&&(t.isReadOnly=!0),console.log(t.data.addStyleProcessorRules()),t.data.addStyleProcessorRules({border:{color:{red:red,red:red,red:red,red:red}}}),this.getData=function(){return t.getData()},this.setData=function(e){let i=t.getData();i+=e,t.setData(i,"text/html")},this.setDataRemove=function(){t.setData("","text/html")},this.destroy=function(){t.destroy()},this.keyDownPrevent=function(){t.editing.view.document.on("keydown",(t,e)=>{t.stop(),e.preventDefault(),e.stopPropagation()},{priority:"highest"})},this.readOnly=function(){t.isReadOnly=!0},i&&this.readOnly(),null!==s&&this.setData(s.contents)})}}const UploadAdapter=class{constructor(t,e,i,s){this.loader=t,this.uploadUrl=e,this.folderName=i,this.tmpFolderName=s}upload(){return this.loader.file.then(t=>new Promise((e,i)=>{this._initRequest(),this._initListeners(e,i,t),this._sendRequest(t)}))}_initRequest(){const t=this.xhr=new XMLHttpRequest;var e=this.uploadUrl+"/"+this.tmpFolderName;t.open("POST",e,!0),t.responseType="json"}_initListeners(t,e,i){const s=this.xhr;this.loader;s.addEventListener("error",()=>{e("파일을 업로드 할 수 없습니다.")}),s.addEventListener("abort",()=>e()),s.addEventListener("load",()=>{const i=s.response;if(!i||i.error)return e(i&&i.error?i.error.message:"파일을 업로드 할 수 없습니다.");console.log(i),$(".js-ckeditor-uploaded").trigger("click.data",i),t({default:i.url})})}_sendRequest(t){var e=new FormData;e.append("upload",t),this.xhr.send(e)}_changeFilesName(t){var e="";e+='<div class="js-delete-file-img" data-idx=""><span>'+t.name+'</span><span class="iconDeleteImg"></span></div>',$(".js-file-name").append(e),this._clickLayerFilesDeleteBtn()}_clickLayerFilesDeleteBtn(){$(".js-delete-file-img").unbind("click").on("click",t=>{var e=$(t.target).closest(".js-delete-file-img").data("file_name");void 0!==e?$(".js-ckeditor-uploaded").trigger("click.delete",e):alert("이미지가 업로드 중입니다.")})}};